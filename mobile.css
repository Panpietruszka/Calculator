/* ========================================================= */
/* GLOBALNE ZMIENNE: Wprowadzamy zmienne CSS, aby łatwo je skalować */
/* ========================================================= */
:root {
    --button-size: 65px; /* Domyślny rozmiar (dla > 400px) */
    --button-gap: 5px;   /* Domyślny odstęp */
    --scientific-buttons-width: 100%; 
    --programming-buttons-width: 100%;
    --normal-buttons-width: 100%;
}


/* ========================================================= */
/* GŁÓWNY BLOK MEDIA QUERY (max-width: 700px) */
/* ========================================================= */
@media (max-width: 700px) {
    
    /* --- GLOBALNE POPRAWKI I MAIN-CONTENT --- */
    body {
        /* POPRAWKA: Używamy 100svh dla stabilności wysokości na mobilnym */
        min-height: 100svh; 
        padding-top: 20px;
        padding-bottom: 20px;
        /* Zapewnienie, że nie ma przewijania */
        overflow-y: hidden; 
        overflow-x: hidden; 
    }

    h1 {
        display: none;
    }
    .main-content {
        width: 100% !important; 
        max-width: 500px;
        height: auto; 
        /* POPRAWKA: Zmiana vh na svh dla stabilności */
        min-height: 85svh; 
        flex-direction: column; 
        margin: 0 auto;
        border-radius: 10px; 
        box-shadow: none; 
        transition: none; 
        transform: translateY(-1rem); 
        padding: 0;
    }

    .main-content.active,
    .main-content.scientific-mode,
    .main-content.scientific-mode.active,
    .main-content.programming-mode,
    .main-content.programming-mode.active {
        width: 100%; 
        padding-right: 0; 
    }

    /* --- MENU PANEL --- */
    .menu-panel {
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        min-height: 100%;
        transform: translateY(100%); 
        transition: transform 0.5s cubic-bezier(0.86, 0, 0.07, 1);
        z-index: 10;
        background: rgba(26, 43, 45, 0.95);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
    }
    .menu-panel.active {
        transform: translateY(0);
        opacity: 1;
        pointer-events: auto;
    }
    .menu-items li {
        width: 90%;
        margin: 10px auto;
        padding: 15px 20px;
    }

    /* --- CALCULATOR BODY AND SCREEN --- */
    .calculator-body {
        width: 100% !important;
        padding: 15px; 
        grid-template-rows: 15% 1fr;
        height: auto; 
        /* POPRAWKA: Zmiana vh na svh dla stabilności */
        min-height: 80svh; 
    }
    .calculator-body.programming-mode {
        /* POPRAWKA: Usunięto min-width: 400px; i zwiększono max-height */
        max-height: 85svh; 
        min-width: unset; 
    }
    .calculator-body.scientific-mode {
        max-height: 85svh; 
    }
    #input {
        font-size: 2rem; 
        padding: 10px 10px;
    }
    #result {
        font-size: 1.5rem; 
    }

    /* --- BUTTONS AND LAYOUT --- */
    .buttons-container {
        flex-direction: column; 
        height: auto; 
        gap: 10px;
    }
    
    .normal-buttons .row button {
        width: var(--button-size); 
        height: var(--button-size); 
        font-size: 1rem; 
    }
    .normal-buttons,
    .scientific-buttons,
    .programming-buttons {
        width: auto; 
        opacity: 1; 
        pointer-events: auto;
        flex-direction: column; 
        height: auto; 
        margin-right: 0 !important; 
        gap: var(--button-gap);
        display: flex; 
        max-height: 0; 
        margin-bottom: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
    }
    
    .calculator-body .normal-buttons {
        max-height: 100vh; 
        opacity: 1; 
    }

    .calculator-body:not(.scientific-mode):not(.programming-mode) .scientific-buttons,
    .calculator-body:not(.scientific-mode):not(.programming-mode) .programming-buttons {
        max-height: 0;
        margin-bottom: 0;
        opacity: 0;
        pointer-events: none;
    }

    /* Tryb Naukowy (Scientific Mode) */
    .calculator-body.scientific-mode .scientific-buttons {
        order: 1; 
        width: 100%;
        flex-direction: row; 
        max-height: 500px; 
        margin-bottom: var(--button-gap);
        opacity: 1;
        pointer-events: auto;
        transform: none;
    }
    #magic-trick {
        display: none; 
    }
    .calculator-body.scientific-mode .normal-buttons {
        order: 2; 
        width: 100%;
        height: auto;
        flex-direction: column;
        max-height: 100vh;
        opacity: 1;
        pointer-events: auto;
    }
    .calculator-body.scientific-mode .buttons-container {
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    /* POPRAWKA: Układ Trybu Programisty (Programming Mode) */
    .calculator-body.programming-mode .programming-buttons {
        order: 1; 
        max-height: 500px; 
        margin-bottom: var(--button-gap);
        opacity: 1;
        pointer-events: auto;
        /* Klucz: Płynna siatka 6 kolumn */
        display: grid; 
        grid-template-columns: repeat(6, 1fr); 
        gap: var(--button-gap); 
        width: 100%;
    }
    
    .calculator-body.programming-mode .normal-buttons {
        order: 2;
        /* Klucz: Płynna siatka 4 kolumn dla cyfr */
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--button-gap);
        width: 100%;
        max-height: 100vh;
        opacity: 1;
        pointer-events: auto;
        flex-direction: unset; 
    }
    
    .calculator-body.programming-mode .scientific-buttons {
        display: none !important; 
        width: 0;
        opacity: 0;
    }
    
    .programming-buttons .row,
    .programming-buttons .row-hex {
        display: contents; 
    }

    .programming-buttons .row button,
    .programming-buttons .row-hex button {
        flex-grow: 1; 
        width: 100%; 
        height: var(--button-size); 
        font-size: 1.1rem;
    }

    .programming-buttons .row-hex button {
        grid-column: span 1; 
    }
    
    .normal-buttons .row,
    .scientific-buttons .row {
        width: 100%;
        gap: var(--button-gap);
        flex-wrap: wrap; 
        justify-content: space-between; 
    }
    
    .buttons-container button {
        flex-grow: 1; 
        min-width: var(--button-size);
        height: var(--button-size); 
        border-radius: 15px; 
        font-size: 1rem; 
    }

    .normal-buttons .row:last-child {
        display: flex; /* Powrót do flex dla ostatniego rzędu (cyfry 0) */
    }
    .normal-buttons .row:last-child button:nth-child(2) {
        width: auto;
        flex-grow: 1;
    }
    
    /* --- NAVIGATION BUTTONS --- */
    .hamburger-menu {
        top: 10px;
        left: 10px;
        z-index: 999;
    }
    
    .main-content.converter-mode .back-icon {
        opacity: 0;
        visibility: hidden;
    }

    .main-content.converter-mode .hamburger-icon {
        opacity: 1;
        visibility: visible;
    }
    
    /* --- HISTORY SECTION --- */
    .history-content {
        padding: 15px; 
    }
    
    .history-list-container {
        padding-right: 0; 
        transform: none; 
        overflow-y: auto; 
        width: 100%; 
    }
    
    #clear-history-btn {
        width: 100%; 
        height: 3rem; 
        margin-top: 10px;
    }
    /* --- CONVERTERS --- */
    .converter-currency-container {
        width: 100%; 
        max-width: none;
    }
    
    /* ========================================================= */
    /* Styles for mode switch (.radio-input) */
    /* POPRAWKA: Usuwamy zmienne z tego bloku, bo definiujemy je na samej górze */
    /* ========================================================= */
    .container {
        position: relative; 
        bottom: auto; 
        left: auto;
        transform: none;
        margin-top: 20px; 
        width: 100%; 
        display: flex; 
        justify-content: center;
    }
    
    .radio-input {
        --container_width: 90vw; 
        max-width: 300px; 
        width: var(--container_width); 
        height: 40px; 
        border-radius: 20px; 
    }

    .radio-input label {
        padding: 8px 0; 
        font-size: 13px; 
        letter-spacing: normal;
    }

    .selection {
        border-radius: 20px;
        width: calc(var(--container_width) / 4);
    }
    /* (Selektory :nth-child dla .selection - zostawione bez zmian) */
    .radio-input label:nth-child(1):has(input:checked)~.selection {
        transform: translateX(calc(var(--container_width) * 0/4));
    }
    .radio-input label:nth-child(2):has(input:checked)~.selection {
        transform: translateX(calc(var(--container_width) * 1/4));
    }
    .radio-input label:nth-child(3):has(input:checked)~.selection {
        transform: translateX(calc(var(--container_width) * 2/4));
    }
    .radio-input label:nth-child(4):has(input:checked)~.selection {
        transform: translateX(calc(var(--container_width) * 3/4));
    }
    
    /* ========================================================= */
    /* Styles for Converter sections (.converter-section) */
    /* ========================================================= */
    .converter-inputs,
    .other-converter-inputs {
        position: relative; 
        top: auto;
        left: auto;
        transform: none;
        padding: 20px 0;
        margin: auto;
        width: 100%; 
        max-width: 95%; 
    }
    .other-converter-inputs {
        top: auto; 
        transform: none;
    }
    .input-group input,
    .custom-select {
        width: 100%; 
        max-width: 250px; 
        margin-bottom: 0.8rem; 
    }
    .input-group input {
        padding: 8px; 
        font-size: 1.1em; 
    }
    .swap-icon-container {
        margin: 0.5rem 0; 
    }
    .converter-section h3 {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        margin-top: 2rem;
        margin-bottom: 20px;
        text-align: center;
    }
    .converter-list-body {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        max-width: 95%; 
        padding: 10px; 
    }
    .converter-list-body h3 {
        margin-bottom: 20px; 
    }
    .main-converters-list li {
        margin-bottom: 10px; 
    }
    .main-converters-list a {
        padding: 12px 0; 
        font-size: 1em;
    }
    .select-selected, .select-items div {
        padding: 8px 12px; 
        font-size: 0.95em;
    }
    .converter-mode-body {
        display: flex !important; 
        position: relative; 
        padding: 15px;
        width: 100%;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: auto;
        box-sizing: border-box;
    }
    .converter-mode-body.section-visible {
        display: flex !important; 
        flex-direction: column; 
        .converter-inputs {
            transform: none;
        }
    }
    .converter-inputs,
    .other-converter-inputs {
        position: relative; 
        top: auto;
        left: auto;
        margin: 10px auto;
    }

    /* ========================================================= */
    /* Styles for mobile devices (phones) - Programming Mode */
    /* Zmodyfikowane elementy grid/flex znajdują się wyżej dla spójności */
    /* ========================================================= */
    .pro-conversions {
        padding: 5px 0; 
        margin-bottom: 5px; 
        border-bottom: none; 
    }
    .conversion-mode-selector button {
        font-size: 0.8rem; 
        padding: 5px;
    }
    .conversion-display-row {
        font-size: 0.8rem; 
    }
    .conversion-display-row span:last-child {
        font-size: 1em; 
    }
    .calculator-body.programming-mode #input {
        font-size: 1.8rem; 
        padding-top: 10px; 
        padding-bottom: 5px;
        grid-row: 1; 
    }
    
    /* ========================================================= */
    /* Styles for Date Calculator */
    /* ========================================================= */
    .date-calculator-body {
        width: 100%;
        /* POPRAWKA: Usunięcie błędnego paddingu */
        padding: 0 15px; 
        box-sizing: border-box;
    }
    
    .date-same-dates-message,
    .date-detailed-results, 
    #current-result {
        position: relative; 
        top: auto;
        left: auto;
        transform: none; 
        width: 100%; 
        padding: 0 10px;
        margin-top: 10px; 
        justify-content: center; 
        text-align: center;
        flex-direction: column; 
        gap: 5px;
    }
    .date-same-dates-message {
        margin-top: 20px; 
    }
    .date-detailed-results {
        flex-direction: column;
        gap: 10px;
        font-size: 0.9em;
    }
    #current-result {
        gap: 0px; 
        margin-top: 20px;
    }
    #date-result-value {
        transform: none; 
        font-size: 1.5rem; 
        font-weight: bold;
    }
    .input-group input[type="date"] {
        width: 100%;
        max-width: 300px; 
        padding: 8px 12px;
        font-size: 1.1rem;
        margin-bottom: 15px; 
    }
    
    /* ========================================================= */
    /* Menu Transform (usunięte sztywne transformacje) */
    /* ========================================================= */
    .menu-content.scientific-active {
        transform: translateX(0); 
    }
    .menu-content.programming-active {
        transform: translateX(0); 
    }
    .menu-content {
        transform: translateX(0); 
    }
}


/* ========================================================= */
/* KRYTYCZNA POPRAWKA: DLA BARDZO MAŁYCH TELEFONÓW (< 400px) */
/* Agresywnie skaluje przyciski i odstępy */
/* ========================================================= */
@media (max-width: 400px) {
    
    /* ZMIENNE: Zmniejszenie rozmiaru przycisków i odstępów */
    :root {
        --button-size: 58px; /* Z 65px na 58px */
        --button-gap: 3px;   /* Z 5px na 3px */
    }

    /* Zapewnij, że padding jest mniejszy, aby dać więcej miejsca na przyciski */
    .calculator-body {
        padding: 10px;
    }
    
    /* Zmniejszenie rozmiaru czcionki w przyciskach */
    .buttons-container button {
        font-size: 0.9rem; /* Z 1rem na 0.9rem */
    }
    
    /* Zmniejszenie font-size dla wyświetlacza */
    #input {
        font-size: 1.8rem; 
    }
    #result {
        font-size: 1.3rem; 
    }
    
    /* Zapewnienie, że przyciski nadal używają zmiennych */
    .normal-buttons .row button {
        width: var(--button-size); 
        height: var(--button-size); 
    }
}
